<div class="store-container">
    <div class="store-header">
        <h2>Elite School Store</h2>
        <div class="header-actions">
            <div class="search-box">
                <input type="text" placeholder="Search items..." (input)="onSearch($event)" />
                <i class="pi pi-search"></i>
            </div>
            <div class="reward-info" *ngIf="currentUserRole === 'STUDENT'">
                <i class="pi pi-star"></i>
                <span>{{ rewardPoints }} Points</span>
            </div>
            <button pButton 
                type="button" 
                icon="pi pi-plus" 
                label="Add Item" 
                class="p-button-primary"
                (click)="addItem()"
                *ngIf="isAdmin()">
            </button>
        </div>
    </div>

    <div class="store-items">
        <div class="item-card" *ngFor="let item of filteredItems">
            <div class="item-image">
                <img [src]="item.imageUrl || 'assets/images/default-item.png'" [alt]="item.name">
            </div>
            <div class="item-content">
                <h3 class="item-name">{{ item.name }}</h3>
                <p class="item-description">{{ item.description }}</p>
                <div class="item-meta">
                    <span class="item-price"><i class="pi pi-star"></i> {{ item.price }} Points</span>
                    <span class="item-stock">{{ item.stock }} in stock</span>
                </div>
                <div class="item-actions">
                    <button pButton 
                        type="button" 
                        icon="pi pi-shopping-cart" 
                        label="Redeem" 
                        class="p-button-success"
                        [disabled]="!canRedeem(item)"
                        (click)="redeemItem(item)"
                        *ngIf="currentUserRole === 'STUDENT'">
                    </button>
                    <button pButton 
                        type="button" 
                        icon="pi pi-pencil" 
                        label="Edit" 
                        class="p-button-primary"
                        (click)="editItem(item)"
                        *ngIf="isAdmin()">
                    </button>
                    <button pButton 
                        type="button" 
                        icon="pi pi-trash" 
                        label="Delete" 
                        class="p-button-danger"
                        (click)="deleteItem(item)"
                        *ngIf="isAdmin()">
                    </button>
                </div>
            </div>
        </div>
        
        <div class="empty-message" *ngIf="filteredItems.length === 0">
            No items available in the store
        </div>
    </div>
</div>

<!-- Item Form Dialog -->
<p-dialog [header]="editMode ? 'Edit Item' : 'Add Item'" [(visible)]="itemDialogVisible" [modal]="true" [style]="{width: '500px'}">
    <form *ngIf="selectedItem" #itemForm="ngForm" (ngSubmit)="saveItem()">
        <div class="field">
            <label for="name">Item Name</label>
            <input id="name" type="text" pInputText [(ngModel)]="selectedItem.name" name="name" required>
        </div>
        <div class="field">
            <label for="description">Description</label>
            <textarea id="description" pInputTextarea [(ngModel)]="selectedItem.description" name="description" rows="5"></textarea>
        </div>
        <div class="field">
            <label for="price">Price (Points)</label>
            <input id="price" type="number" pInputText [(ngModel)]="selectedItem.price" name="price" required min="1">
        </div>
        <div class="field">
            <label for="stock">Stock Available</label>
            <input id="stock" type="number" pInputText [(ngModel)]="selectedItem.stock" name="stock" required min="0">
        </div>
        <div class="field">
            <label for="imageUrl">Image URL (Optional)</label>
            <input id="imageUrl" type="text" pInputText [(ngModel)]="selectedItem.imageUrl" name="imageUrl">
        </div>
        <div class="dialog-footer">
            <button pButton type="button" label="Cancel" icon="pi pi-times" 
                    class="p-button-text" (click)="itemDialogVisible = false"></button>
            <button pButton type="submit" label="Save" icon="pi pi-check" 
                    [disabled]="!itemForm.valid"></button>
        </div>
    </form>
</p-dialog>

<!-- Confirmation Dialog -->
<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>
